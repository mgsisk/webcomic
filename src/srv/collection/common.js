!function(){"use strict";!function e(){if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",e);var r={minDistance:150,maxTime:300,time:0,posX:0,posY:0},c=parseInt((window.location.search.match(/wi=(\d+)/)||["",0])[1]);function a(){var e=document.querySelector(".webcomic-infinite, [data-webcomic-infinite]");if(function(e){{if(!e)return window.removeEventListener("scroll",a),!1;if(e.classList.contains("loading"))return!1}var t=e.children[e.children.length-1],n=window.scrollY+window.innerHeight,o=0;t&&(o=t.getBoundingClientRect().top+window.scrollY);{if(t&&n<o)return!1;if(e.querySelector("wbr.finished"))return window.removeEventListener("scroll",a),!1}return e.classList.add("loading"),!0}(e)){var t=new FormData,n=new XMLHttpRequest,o=parseInt(e.children.length)+c,i=window.location.href.replace(/wi=\d+/,"wi=".concat(o));window.location.search||(i="".concat(window.location.href,"?wi=").concat(o)),t.append("action","webcomic_infinite"),t.append("url",window.location.href),t.append("args","offset=".concat(o,"&").concat(e.getAttribute("data-webcomic-infinite"))),n.onreadystatechange=function(){4===n.readyState&&(e.innerHTML+=n.responseText,e.classList.remove("loading"),history.replaceState({},"",i))},n.open("POST",webcomicCommonJS.ajaxurl),n.send(t)}}function t(e){if("select"===e.target.tagName.toLowerCase()&&e.target.options[e.target.selectedIndex].getAttribute("data-webcomic-url")){var t=e.target.options[e.target.selectedIndex].getAttribute("data-webcomic-url");t!==window.location.href&&(window.location.href=t)}}function n(e){if(!e.target.tagName.toLowerCase().match(/button|input|meter|option|output|progress|select|textarea/)&&null===e.target.getAttribute("contenteditable")){var t=document.querySelector(".webcomic-keyboard, [data-webcomic-shortcuts]"),n=e.key;t&&(e.shiftKey&&(n+="Shift"),u(n,t))}}function o(e){var o=document.querySelectorAll(".webcomic-dynamic");if(o.length){for(var i=e.target;i.tagName&&!i.classList.contains("webcomic-link");)i=i.parentNode;if(i.tagName){e.preventDefault();var t=new FormData,c=new XMLHttpRequest;t.append("action","webcomic_dynamic"),c.onreadystatechange=function(){if(4===c.readyState){var e=document.createElement("div");e.innerHTML=c.responseText;var t=e.querySelectorAll(".webcomic-dynamic");if(t.length)for(var n=0;n<o.length;n++)o[n].parentNode.replaceChild(t[n],o[n]);else window.location.href=i.href}},c.open("POST",i.href),c.send(t)}}}function d(e){if(!document.querySelector(".webcomic-gestures, [data-webcomic-gestures]"))return document.documentElement.removeEventListener("touchstart",d,!1),void document.documentElement.removeEventListener("touchend",s);r.time=(new Date).getTime(),r.posX=e.changedTouches[0].pageX,r.posY=e.changedTouches[0].pageY}function s(e){var t=document.querySelector(".webcomic-gestures, [data-webcomic-gestures]"),n=(new Date).getTime()-r.time,o=e.changedTouches[0].pageX-r.posX,i=e.changedTouches[0].pageY-r.posY;if(!t)return document.documentElement.removeEventListener("touchstart",d,!1),void document.documentElement.removeEventListener("touchend",s);if(!(n>r.maxTime)){var c=function(e,t,n){var o="Arrow";Math.abs(t)>=r.minDistance&&Math.abs(n)<r.minDistance?(o+="Right",0<t&&(o=o.replace("Right","Left"))):Math.abs(n)>=r.minDistance&&Math.abs(t)<r.minDistance&&(o+="Down",0<n&&(o=o.replace("Down","Up")));1<e.changedTouches.length&&(o+="Shift");return o}(e,o,i);c.replace(/^Arrow(Shift)?$/,"")&&u(c,t)}}function u(e,t){var n=t.querySelector(".".concat({ArrowDownShift:"random-webcomic-link",ArrowLeft:"previous-webcomic-link",ArrowLeftShift:"first-webcomic-link",ArrowRight:"next-webcomic-link",ArrowRightShift:"last-webcomic-link",ArrowUpShift:"webcomic-print-link"}[e],"[href]"));e&&t&&n&&n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0}))}window.addEventListener("scroll",a),document.addEventListener("change",t),document.addEventListener("keyup",n),document.addEventListener("click",o),document.documentElement.addEventListener("touchstart",d,!1),document.documentElement.addEventListener("touchend",s),window.dispatchEvent(new Event("scroll"))}()}();
